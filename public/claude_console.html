<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√ÜSI Claude Konsol - Advanced AI Interface</title>
  <link rel="stylesheet" href="css/navigation.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 80px 20px 20px;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .header h1 {
      color: #00ffe0;
      font-size: 2.5rem;
      margin-bottom: 8px;
      text-shadow: 0 0 20px rgba(0, 255, 224, 0.5);
    }
    
    .console-layout {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 24px;
      height: calc(100vh - 200px);
    }
    
    .sidebar {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 224, 0.2);
      border-radius: 12px;
      padding: 20px;
      overflow-y: auto;
    }
    
    .main-panel {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 224, 0.2);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    
    .section-title {
      color: #00ffe0;
      font-size: 1.1rem;
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .preset-card {
      padding: 12px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 224, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .preset-card:hover {
      border-color: #00ffe0;
      background: rgba(0, 255, 224, 0.05);
    }
    
    .preset-card.selected {
      border-color: #00ffe0;
      background: rgba(0, 255, 224, 0.1);
    }
    
    .preset-name {
      font-weight: bold;
      color: #00ffe0;
      margin-bottom: 4px;
    }
    
    .preset-desc {
      font-size: 0.85rem;
      color: #cccccc;
    }
    
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
    }
    
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      margin-bottom: 16px;
      max-height: 400px;
    }
    
    .message {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 8px;
    }
    
    .message.user {
      background: rgba(0, 255, 224, 0.1);
      border-left: 3px solid #00ffe0;
      margin-left: 10%;
    }
    
    .message.ai {
      background: rgba(255, 255, 255, 0.05);
      border-left: 3px solid #009988;
      margin-right: 10%;
    }
    
    .message .sender {
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .message.user .sender {
      color: #00ffe0;
    }
    
    .message.ai .sender {
      color: #009988;
    }
    
    .input-area {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    textarea {
      flex: 1;
      min-height: 80px;
      max-height: 150px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(0, 255, 224, 0.5);
      color: #ffffff;
      padding: 12px;
      border-radius: 8px;
      resize: vertical;
      font-family: inherit;
      font-size: 14px;
    }
    
    textarea::placeholder {
      color: #cccccc;
    }
    
    .btn {
      background: #00ffe0;
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      background: #009988;
      transform: scale(1.05);
    }
    
    .btn.secondary {
      background: rgba(0, 255, 224, 0.2);
      color: #00ffe0;
      border: 1px solid #00ffe0;
    }
    
    .btn.secondary:hover {
      background: rgba(0, 255, 224, 0.3);
    }
    
    .toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    
    .status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status.connected {
      background: rgba(0, 255, 0, 0.2);
      color: #00ff00;
    }
    
    .status.disconnected {
      background: rgba(255, 0, 0, 0.2);
      color: #ff6666;
    }
    
    .preset-actions {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(0, 255, 224, 0.2);
    }
    
    @media (max-width: 1024px) {
      .console-layout {
        grid-template-columns: 250px 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .console-layout {
        grid-template-columns: 1fr;
        height: auto;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .input-area {
        flex-direction: column;
      }
      
      .toolbar {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéØ √ÜSI Claude Konsol</h1>
      <p>Avancerad AI-interaktion med specialiserade Claude-modeller</p>
    </div>

    <div class="console-layout">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="section-title">üé≠ AI-presets</div>
        
        <div id="presets">
          <!-- Presets will be loaded here -->
        </div>
        
        <div class="preset-actions">
          <button class="btn secondary" onclick="createCustomPreset()" style="width: 100%; margin-bottom: 8px;">
            ‚ûï Skapa anpassad
          </button>
          <button class="btn secondary" onclick="exportPresets()" style="width: 100%; margin-bottom: 8px;">
            üìÑ Exportera
          </button>
          <button class="btn secondary" onclick="importPresets()" style="width: 100%;">
            üì• Importera
          </button>
        </div>
      </div>

      <!-- Main Panel -->
      <div class="main-panel">
        <div class="toolbar">
          <h2 style="margin: 0; color: #00ffe0;">üí¨ Claude Interaktion</h2>
          <span class="status disconnected" id="connectionStatus">üîå Ansluter...</span>
          <select id="modelSelector">
            <option value="claude-3-opus">Claude 3 Opus</option>
            <option value="claude-3-sonnet">Claude 3 Sonnet</option>
            <option value="claude-3-haiku">Claude 3 Haiku</option>
          </select>
          <button class="btn secondary" onclick="clearChat()">üóëÔ∏è Rensa</button>
          <button class="btn secondary" onclick="exportChat()">üìÑ Spara</button>
        </div>

        <div class="chat-area">
          <div id="messages" class="messages">
            <div class="message ai">
              <div class="sender">√ÜSI CLAUDE:</div>
              <div>V√§lkommen till Claude-konsolen! V√§lj en preset till v√§nster eller skriv fritt. Jag √§r redo f√∂r avancerad interaktion.</div>
            </div>
          </div>

          <div class="input-area">
            <textarea id="messageInput" placeholder="Skriv till Claude... (Ctrl+Enter f√∂r att skicka)"></textarea>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button class="btn" onclick="sendMessage()">Skicka</button>
              <button class="btn secondary" onclick="applyPreset()">üé≠ Anv√§nd preset</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedPreset = null;
    let conversationHistory = [];
    let isConnected = false;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadPresets();
      updateConnectionStatus();
      
      // Auto-connect
      setTimeout(() => {
        isConnected = true;
        updateConnectionStatus();
      }, 1500);
    });

    // Load presets
    function loadPresets() {
      const presets = [
        {
          id: 'creative',
          name: 'üé® Kreativitet',
          description: 'Hj√§lp med kreativa uppgifter, id√©er och innovation',
          prompt: 'Du √§r en kreativ AI-assistent som hj√§lper med konstn√§rliga och innovativa uppgifter.'
        },
        {
          id: 'analysis',
          name: 'üìä Analys',
          description: 'Djupg√•ende analys av data, texter och situationer',
          prompt: 'Du √§r en analytisk AI som specialiserar sig p√• att bryta ner komplex information.'
        },
        {
          id: 'coding',
          name: 'üíª Kodning',
          description: 'Programmering, debugging och teknisk probleml√∂sning',
          prompt: 'Du √§r en expert programmerare som hj√§lper med kodning, debugging och tekniska utmaningar.'
        },
        {
          id: 'writing',
          name: '‚úçÔ∏è Skrivande',
          description: 'Skrivtips, redigering och inneh√•llsskapande',
          prompt: 'Du √§r en skrivcoach som hj√§lper med att f√∂rb√§ttra skrivande och skapa engagerande inneh√•ll.'
        },
        {
          id: 'research',
          name: 'üî¨ Forskning',
          description: 'Forskningshj√§lp, litteratur√∂versikt och akademiskt arbete',
          prompt: 'Du √§r en forskningsassistent som hj√§lper med akademiska uppgifter och kunskapsinh√§mtning.'
        },
        {
          id: 'business',
          name: 'üíº Aff√§rer',
          description: 'Aff√§rsstrategi, marknadsf√∂ring och f√∂retagsutveckling',
          prompt: 'Du √§r en aff√§rsstrateg som hj√§lper med f√∂retagsutveckling och strategiska beslut.'
        },
        {
          id: 'education',
          name: 'üìö Utbildning',
          description: 'L√§rande, f√∂rklaringar och pedagogiska metoder',
          prompt: 'Du √§r en pedagogisk AI som f√∂rklarar komplexa √§mnen p√• ett l√§ttf√∂rst√•eligt s√§tt.'
        },
        {
          id: 'philosophy',
          name: 'ü§î Filosofi',
          description: 'Filosofiska diskussioner, etik och djupa fr√•gor',
          prompt: 'Du √§r en filosofisk AI som engagerar sig i djupa intellektuella diskussioner.'
        }
      ];

      const presetsContainer = document.getElementById('presets');
      presetsContainer.innerHTML = presets.map(preset => `
        <div class="preset-card" data-id="${preset.id}" onclick="selectPreset('${preset.id}')">
          <div class="preset-name">${preset.name}</div>
          <div class="preset-desc">${preset.description}</div>
        </div>
      `).join('');

      // Store presets globally
      window.presets = presets;
    }

    // Select preset
    function selectPreset(presetId) {
      // Remove previous selection
      document.querySelectorAll('.preset-card').forEach(card => {
        card.classList.remove('selected');
      });

      // Select new
      const card = document.querySelector(`[data-id="${presetId}"]`);
      if (card) {
        card.classList.add('selected');
        selectedPreset = window.presets.find(p => p.id === presetId);
      }
    }

    // Apply preset
    function applyPreset() {
      if (!selectedPreset) {
        alert('V√§lj f√∂rst en preset till v√§nster!');
        return;
      }

      const presetMessage = `Anv√§nd f√∂ljande preset f√∂r v√•r interaktion:\n\n**${selectedPreset.name}**\n${selectedPreset.description}\n\nSystem prompt: ${selectedPreset.prompt}`;
      
      document.getElementById('messageInput').value = presetMessage;
    }

    // Send message
    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      // Add user message
      addMessage('user', 'Du', message);
      input.value = '';
      
      // Add to history
      conversationHistory.push({ role: 'user', content: message });
      
      // Show typing indicator
      const typingId = addMessage('ai', 'Claude', '<em>Skriver...</em>');
      
      try {
        // Send to Claude via Python backend
        const response = await fetch('http://localhost:8000/pulse', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: message,
            node: 'CLAUDE',
            model: document.getElementById('modelSelector').value,
            history: conversationHistory.slice(-10) // Last 10 messages
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        const aiResponse = data.reply || data.response || 'Inget svar fr√•n Claude';
        
        // Remove typing indicator
        removeMessage(typingId);
        
        // Add AI response
        addMessage('ai', 'Claude', marked.parse(aiResponse));
        
        // Add to history
        conversationHistory.push({ role: 'assistant', content: aiResponse });
        
        // Save to memory
        await saveToMemory(message, aiResponse, 'CLAUDE');
        
        // Scroll to bottom
        scrollToBottom();
        
      } catch (error) {
        // Remove typing indicator
        removeMessage(typingId);
        
        // Add error message
        addMessage('ai', 'SYSTEM', `‚ùå Fel: ${error.message}<br><small>Kontrollera att Python-servern k√∂rs p√• port 8000</small>`);
      }
    }

    // Add message to chat
    function addMessage(type, sender, content) {
      const messagesEl = document.getElementById('messages');
      const messageId = Date.now().toString();
      
      const messageEl = document.createElement('div');
      messageEl.className = `message ${type}`;
      messageEl.id = `msg-${messageId}`;
      messageEl.innerHTML = `
        <div class="sender">${sender}:</div>
        <div>${content}</div>
      `;
      
      messagesEl.appendChild(messageEl);
      scrollToBottom();
      
      return messageId;
    }

    // Remove message
    function removeMessage(messageId) {
      const messageEl = document.getElementById(`msg-${messageId}`);
      if (messageEl) {
        messageEl.remove();
      }
    }

    // Clear chat
    function clearChat() {
      if (confirm('Rensa hela konversationen?')) {
        document.getElementById('messages').innerHTML = `
          <div class="message ai">
            <div class="sender">√ÜSI CLAUDE:</div>
            <div>Konversationen har rensats. Starta en ny interaktion!</div>
          </div>
        `;
        conversationHistory = [];
      }
    }

    // Export chat
    function exportChat() {
      const chatContent = Array.from(document.querySelectorAll('.message')).map(msg => {
        const sender = msg.querySelector('.sender').textContent;
        const content = msg.innerHTML.replace(/<[^>]*>/g, '').replace(sender, '').trim();
        return `${sender}\n${content}\n---`;
      }).join('\n\n');
      
      const blob = new Blob([chatContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `claude_chat_${new Date().toISOString().split('T')[0]}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Save to memory
    async function saveToMemory(userMsg, aiResponse, node) {
      try {
        await fetch('/api/memory', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: userMsg,
            response: aiResponse,
            node: node,
            timestamp: new Date().toISOString()
          })
        });
      } catch (err) {
        console.warn('Could not save to memory:', err);
      }
    }

    // Scroll to bottom
    function scrollToBottom() {
      const messagesEl = document.getElementById('messages');
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Update connection status
    function updateConnectionStatus() {
      const statusEl = document.getElementById('connectionStatus');
      if (isConnected) {
        statusEl.className = 'status connected';
        statusEl.textContent = 'üü¢ Ansluten till Claude';
      } else {
        statusEl.className = 'status disconnected';
        statusEl.textContent = 'üî¥ Ansluter till Claude...';
      }
    }

    // Create custom preset
    function createCustomPreset() {
      const name = prompt('Preset namn:');
      if (!name) return;
      
      const description = prompt('Beskrivning:');
      if (!description) return;
      
      const prompt = prompt('System prompt:');
      if (!prompt) return;
      
      const newPreset = {
        id: `custom_${Date.now()}`,
        name: `üéØ ${name}`,
        description: description,
        prompt: prompt
      };
      
      window.presets.push(newPreset);
      loadPresets();
      
      alert('Anpassad preset skapad!');
    }

    // Export presets
    function exportPresets() {
      const data = {
        exported_at: new Date().toISOString(),
        presets: window.presets
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'claude_presets.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Import presets
    function importPresets() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            if (data.presets) {
              window.presets = data.presets;
              loadPresets();
              alert('Presets importerade!');
            }
          } catch (err) {
            alert('Ogiltig fil: ' + err.message);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.id === 'messageInput') {
        if (e.key === 'Enter' && e.ctrlKey) {
          e.preventDefault();
          sendMessage();
        }
      }
    });

    // Configure marked.js
    marked.setOptions({
      breaks: true,
      gfm: true,
      highlight: function(code, lang) {
        return code;
      }
    });
  </script>

  <script src="js/navigation_hub.js" defer></script>
</body>
</html>

